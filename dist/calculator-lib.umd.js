(function(a,i){typeof exports=="object"&&typeof module<"u"?i(exports):typeof define=="function"&&define.amd?define(["exports"],i):(a=typeof globalThis<"u"?globalThis:a||self,i(a.CalculatorLib={}))})(this,function(a){"use strict";var c=Object.defineProperty;var m=(a,i,o)=>i in a?c(a,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[i]=o;var r=(a,i,o)=>(m(a,typeof i!="symbol"?i+"":i,o),o);class i{constructor(t,e){r(this,"_modifiers",[]);r(this,"_params");r(this,"_config");r(this,"addModifier",t=>{this.modifiers=[...this.modifiers,new o(t)]});r(this,"removeModifier",t=>{this.modifiers=this.modifiers.filter(e=>e.id!==t)});r(this,"changeModifier",t=>{this.modifiers=[...this.modifiers.filter(e=>e.id!==t.id),new o(t)]});r(this,"setParam",(t,e)=>{this.params={...this.params,[t]:e}});r(this,"calculate",()=>{var e,l;const t=(e=this._config)!=null&&e.calculate?this._config.calculate(this.params):this.calculatorCallback(this.params);return(l=this._config)!=null&&l.onChange&&this._config.onChange(t),t});r(this,"calculatorCallback",t=>!t||!t.price||!t.qty?0:this.applyModifiers(this.applyModifiers(t.price,this.modifiers.filter(e=>e.scope==="price"&&!!e.config.value).sort((e,l)=>e.priority-l.priority))*t.qty,this.modifiers.filter(e=>e.scope==="total"&&!!e.config.value).sort((e,l)=>e.priority-l.priority)));r(this,"applyModifiers",(t,e)=>e.reduce((l,y)=>y.handle(l),t));this._params=t,this._config={...e},this.calculate()}get modifiers(){return this._modifiers}set modifiers(t){this._modifiers=t,this.calculate()}get params(){return this._params}set params(t){this._params=t,this.calculate()}}class o{constructor(t){r(this,"id");r(this,"value");r(this,"scope");r(this,"priority",10);r(this,"config");r(this,"operationStrategy");r(this,"operationTypeStrategy");switch(this.id=t.id,this.value=t.value,this.scope=t.scope,this.priority=t.priority||10,this.config=t,t.operation){case"sub":this.operationStrategy=u;break;case"multiple":this.operationStrategy=h;break;default:this.operationStrategy=p;break}switch(t.type){case"percent":this.operationTypeStrategy=n;break;default:this.operationTypeStrategy=d;break}}handle(t){return!this.operationStrategy||!this.operationTypeStrategy?t:this.operationStrategy.handle(t,{...this.config,value:this.operationTypeStrategy.handle(t,this.config)})}}const p={handle:(s,t)=>s+t.value*((t==null?void 0:t.multiplier)||1)},u={handle:(s,t)=>s-t.value*((t==null?void 0:t.multiplier)||1)},h={handle:(s,t)=>(t==null?void 0:t.multiplier)===0?s:s*t.value*((t==null?void 0:t.multiplier)||1)},n={handle:(s,t)=>t.operation&&t.operation==="multiple"?t.value/100:s*t.value/100},d={handle:(s,t)=>t.value};a.Calculator=i,Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})});
